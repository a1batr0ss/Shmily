[bits 32]
%define ERRCODE nop
%define NOERRCODE push 0

extern general_intr_handler

%macro INTR_HANDLER 2
section .text
global intr_handler%1
intr_handler%1:
    cli
    %2
    push ds
    push es
    push fs
    push gs
    pushad

    mov al, 0x20
    out 0xa0, al
    out 0x20, al

    push %1
    call general_intr_handler
    jmp intr_exit
%endmacro

global intr_exit
intr_exit:
    add esp, 4
    popad
    pop gs
    pop fs
    pop es
    pop ds
    add esp, 4
    iretd

INTR_HANDLER 0, NOERRCODE
INTR_HANDLER 1, NOERRCODE
INTR_HANDLER 2, NOERRCODE
INTR_HANDLER 3, NOERRCODE
INTR_HANDLER 4, NOERRCODE
INTR_HANDLER 5, NOERRCODE
INTR_HANDLER 6, NOERRCODE
INTR_HANDLER 7, NOERRCODE
INTR_HANDLER 8, ERRCODE
INTR_HANDLER 9, NOERRCODE
INTR_HANDLER 10, ERRCODE
INTR_HANDLER 11, ERRCODE
INTR_HANDLER 12, NOERRCODE
INTR_HANDLER 13, ERRCODE
INTR_HANDLER 14, ERRCODE
INTR_HANDLER 15, NOERRCODE
INTR_HANDLER 16, NOERRCODE
INTR_HANDLER 17, ERRCODE
INTR_HANDLER 18, NOERRCODE
INTR_HANDLER 19, NOERRCODE
INTR_HANDLER 20, NOERRCODE
INTR_HANDLER 21, NOERRCODE
INTR_HANDLER 22, NOERRCODE
INTR_HANDLER 23, NOERRCODE
INTR_HANDLER 24, ERRCODE
INTR_HANDLER 25, NOERRCODE
INTR_HANDLER 26, ERRCODE
INTR_HANDLER 27, ERRCODE
INTR_HANDLER 28, NOERRCODE
INTR_HANDLER 29, ERRCODE
INTR_HANDLER 30, ERRCODE
INTR_HANDLER 31, NOERRCODE
INTR_HANDLER 32, NOERRCODE
INTR_HANDLER 33, NOERRCODE
INTR_HANDLER 34, NOERRCODE
INTR_HANDLER 35, NOERRCODE
INTR_HANDLER 36, NOERRCODE
INTR_HANDLER 37, NOERRCODE
INTR_HANDLER 38, NOERRCODE
INTR_HANDLER 39, NOERRCODE
INTR_HANDLER 40, NOERRCODE
INTR_HANDLER 41, NOERRCODE
INTR_HANDLER 42, NOERRCODE
INTR_HANDLER 43, NOERRCODE
INTR_HANDLER 44, NOERRCODE
INTR_HANDLER 45, NOERRCODE
INTR_HANDLER 46, NOERRCODE
INTR_HANDLER 47, NOERRCODE

